<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="order.title">Оформить доставку | SV Express</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body class="antialiased min-h-screen">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-4 py-4 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2">
                <span class="font-bold text-xl tracking-tighter text-slate-900">SV EXPRESS</span>
            </a>
            <a href="index.html" class="text-sm text-slate-500 hover:text-slate-700 flex items-center gap-2 transition-colors">
                <span class="iconify" data-icon="lucide:arrow-left" data-width="16"></span>
                <span data-i18n="order.back">На главную</span>
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-3xl mx-auto px-4 py-10">

        <!-- Page Header -->
        <div class="ds-page-header">
            <h1 class="ds-page-title" data-i18n="order.title">Оформить доставку</h1>
            <p class="ds-page-subtitle" data-i18n="order.subtitle">Заполните форму и мы свяжемся с вами в течение 30 минут</p>
        </div>

        <form id="order-form">

            <!-- Section 1: Sender -->
            <div class="ds-form-section">
                <div class="ds-section-header">
                    <div class="ds-section-icon blue">
                        <span class="iconify" data-icon="lucide:user" data-width="20"></span>
                    </div>
                    <div>
                        <h2 class="ds-section-title" data-i18n="order.sender.title">Данные отправителя</h2>
                        <p class="ds-section-subtitle" data-i18n="order.sender.subtitle">Ваши контактные данные и адрес забора</p>
                    </div>
                </div>

                <div class="ds-form-grid cols-2">
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.sender.email">Email</label>
                        <input type="email" name="sender_email" required class="ds-input" placeholder="email@example.com">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.sender.phone">Телефон</label>
                        <input type="tel" name="sender_phone" required class="ds-input" placeholder="+33 6 12 34 56 78">
                    </div>
                    <div class="ds-field ds-col-span-2">
                        <label class="ds-label required" data-i18n="order.sender.name">Имя и Фамилия (латиницей)</label>
                        <input type="text" name="sender_name" required class="ds-input" placeholder="Ivan Ivanov">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.sender.country">Страна отправления</label>
                        <div class="ds-select-wrapper">
                            <select name="sender_country" required class="ds-input">
                                <option value="" data-i18n="order.sender.country.select">Выберите страну</option>
                                <option value="FR" data-i18n="order.country.FR">Франция</option>
                                <option value="DE" data-i18n="order.country.DE">Германия</option>
                                <option value="GB" data-i18n="order.country.GB">Великобритания</option>
                                <option value="IT" data-i18n="order.country.IT">Италия</option>
                                <option value="ES" data-i18n="order.country.ES">Испания</option>
                                <option value="AT" data-i18n="order.country.AT">Австрия</option>
                                <option value="BE" data-i18n="order.country.BE">Бельгия</option>
                                <option value="NL" data-i18n="order.country.NL">Нидерланды</option>
                                <option value="PL" data-i18n="order.country.PL">Польша</option>
                                <option value="CZ" data-i18n="order.country.CZ">Чехия</option>
                                <option value="CH" data-i18n="order.country.CH">Швейцария</option>
                                <option value="PT" data-i18n="order.country.PT">Португалия</option>
                                <option value="GR" data-i18n="order.country.GR">Греция</option>
                                <option value="SE" data-i18n="order.country.SE">Швеция</option>
                                <option value="DK" data-i18n="order.country.DK">Дания</option>
                                <option value="FI" data-i18n="order.country.FI">Финляндия</option>
                                <option value="OTHER" data-i18n="order.country.OTHER">Другая страна</option>
                            </select>
                        </div>
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.sender.city">Город</label>
                        <input type="text" name="sender_city" required class="ds-input" placeholder="Paris">
                    </div>
                    <div class="ds-field ds-col-span-2">
                        <label class="ds-label required" data-i18n="order.sender.address">Адрес (улица, дом)</label>
                        <input type="text" name="sender_address" required class="ds-input" placeholder="123 Rue de la Paix">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label" data-i18n="order.sender.address2">Квартира / офис</label>
                        <input type="text" name="sender_address2" class="ds-input" placeholder="Apt 5B">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.sender.postcode">Почтовый индекс</label>
                        <input type="text" name="sender_postcode" required class="ds-input" placeholder="75001">
                    </div>
                </div>
            </div>

            <!-- Section 2: Recipient -->
            <div class="ds-form-section">
                <div class="ds-section-header">
                    <div class="ds-section-icon green">
                        <span class="iconify" data-icon="lucide:map-pin" data-width="20"></span>
                    </div>
                    <div>
                        <h2 class="ds-section-title" data-i18n="order.recipient.title">Данные получателя</h2>
                        <p class="ds-section-subtitle" data-i18n="order.recipient.subtitle">Куда доставить посылку</p>
                    </div>
                </div>

                <div class="ds-form-grid cols-2">
                    <div class="ds-field ds-col-span-2">
                        <label class="ds-label required" data-i18n="order.recipient.name">Имя и Фамилия (латиницей)</label>
                        <input type="text" name="recipient_name" required class="ds-input" placeholder="Maria Petrova">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.recipient.phone">Телефон</label>
                        <input type="tel" name="recipient_phone" required class="ds-input" placeholder="+7 999 123 45 67">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.recipient.country">Страна доставки</label>
                        <div class="ds-select-wrapper">
                            <select name="recipient_country" required class="ds-input">
                                <option value="" data-i18n="order.recipient.country.select">Выберите страну</option>
                                <option value="RU" data-i18n="order.country.RU">Россия</option>
                                <option value="MD" data-i18n="order.country.MD">Молдова</option>
                                <option value="BY" data-i18n="order.country.BY">Беларусь</option>
                                <option value="KZ" data-i18n="order.country.KZ">Казахстан</option>
                                <option value="UA" data-i18n="order.country.UA">Украина</option>
                                <option value="AM" data-i18n="order.country.AM">Армения</option>
                                <option value="GE" data-i18n="order.country.GE">Грузия</option>
                                <option value="AZ" data-i18n="order.country.AZ">Азербайджан</option>
                                <option value="UZ" data-i18n="order.country.UZ">Узбекистан</option>
                                <option value="KG" data-i18n="order.country.KG">Кыргызстан</option>
                                <option value="TJ" data-i18n="order.country.TJ">Таджикистан</option>
                            </select>
                        </div>
                    </div>
                    <div class="ds-field">
                        <label class="ds-label" data-i18n="order.recipient.region">Область / Регион</label>
                        <input type="text" name="recipient_region" class="ds-input" placeholder="Московская область">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.recipient.city">Город</label>
                        <input type="text" name="recipient_city" required class="ds-input" placeholder="Москва">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.recipient.street">Улица</label>
                        <input type="text" name="recipient_street" required class="ds-input" placeholder="ул. Примерная">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.recipient.house">Дом</label>
                        <input type="text" name="recipient_house" required class="ds-input" placeholder="15">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label" data-i18n="order.recipient.apartment">Квартира</label>
                        <input type="text" name="recipient_apartment" class="ds-input" placeholder="25">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.recipient.postcode">Почтовый индекс</label>
                        <input type="text" name="recipient_postcode" required class="ds-input" placeholder="123456">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.recipient.service">Служба доставки</label>
                        <div class="ds-select-wrapper">
                            <select name="delivery_service" required class="ds-input">
                                <option value="" data-i18n="order.recipient.service.select">Выберите службу</option>
                                <option value="post_ru" data-i18n="order.service.post_ru">Почта России</option>
                                <option value="cdek" data-i18n="order.service.cdek">СДЭК</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Parcel -->
            <div class="ds-form-section">
                <div class="ds-section-header">
                    <div class="ds-section-icon orange">
                        <span class="iconify" data-icon="lucide:package" data-width="20"></span>
                    </div>
                    <div>
                        <h2 class="ds-section-title" data-i18n="order.parcel.title">Параметры посылки</h2>
                        <p class="ds-section-subtitle" data-i18n="order.parcel.subtitle">Вес и габариты отправления</p>
                    </div>
                </div>

                <div class="ds-form-grid cols-4">
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.parcel.weight">Вес (кг)</label>
                        <input type="number" name="parcel_weight" required step="0.1" min="0.1" max="30" class="ds-input" placeholder="5.5">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label" data-i18n="order.parcel.length">Длина (см)</label>
                        <input type="number" name="parcel_length" step="1" min="1" class="ds-input" placeholder="30">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label" data-i18n="order.parcel.width">Ширина (см)</label>
                        <input type="number" name="parcel_width" step="1" min="1" class="ds-input" placeholder="20">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label" data-i18n="order.parcel.height">Высота (см)</label>
                        <input type="number" name="parcel_height" step="1" min="1" class="ds-input" placeholder="15">
                    </div>
                </div>

                <div class="ds-info-box blue mt-4">
                    <span class="iconify ds-info-box-icon" data-icon="lucide:info"></span>
                    <span data-i18n="order.parcel.notice">Максимальный вес: 30 кг. Сумма всех сторон не более 180 см. Штраф за негабарит: £20.</span>
                </div>
            </div>

            <!-- Section 4: Declaration -->
            <div class="ds-form-section">
                <div class="ds-section-header">
                    <div class="ds-section-icon purple">
                        <span class="iconify" data-icon="lucide:file-text" data-width="20"></span>
                    </div>
                    <div>
                        <h2 class="ds-section-title" data-i18n="order.items.title">Содержимое посылки</h2>
                        <p class="ds-section-subtitle" data-i18n="order.items.subtitle">Опишите товары на английском языке</p>
                    </div>
                </div>

                <div id="items-container" class="space-y-3">
                    <!-- Item 1 -->
                    <div class="ds-item-row" data-item="1">
                        <div class="ds-form-grid cols-4">
                            <div class="ds-field ds-col-span-2">
                                <label class="ds-label" data-i18n="order.items.description">Описание товара</label>
                                <input type="text" name="item_desc_1" class="ds-input" placeholder="Used clothes, shoes, etc.">
                            </div>
                            <div class="ds-field">
                                <label class="ds-label" data-i18n="order.items.quantity">Кол-во</label>
                                <input type="number" name="item_qty_1" min="1" value="1" class="ds-input" style="text-align: center;">
                            </div>
                            <div class="ds-field">
                                <label class="ds-label" data-i18n="order.items.price">Цена (€)</label>
                                <input type="number" name="item_price_1" step="0.01" min="0" class="ds-input" placeholder="10">
                            </div>
                        </div>
                    </div>
                    <!-- Item 2 -->
                    <div class="ds-item-row" data-item="2">
                        <div class="ds-form-grid cols-4">
                            <div class="ds-field ds-col-span-2">
                                <input type="text" name="item_desc_2" class="ds-input" data-placeholder-i18n="order.items.description" placeholder="Описание товара">
                            </div>
                            <div class="ds-field">
                                <input type="number" name="item_qty_2" min="1" value="1" class="ds-input" style="text-align: center;">
                            </div>
                            <div class="ds-field">
                                <input type="number" name="item_price_2" step="0.01" min="0" class="ds-input" placeholder="€">
                            </div>
                        </div>
                    </div>
                    <!-- Item 3 -->
                    <div class="ds-item-row" data-item="3">
                        <div class="ds-form-grid cols-4">
                            <div class="ds-field ds-col-span-2">
                                <input type="text" name="item_desc_3" class="ds-input" data-placeholder-i18n="order.items.description" placeholder="Описание товара">
                            </div>
                            <div class="ds-field">
                                <input type="number" name="item_qty_3" min="1" value="1" class="ds-input" style="text-align: center;">
                            </div>
                            <div class="ds-field">
                                <input type="number" name="item_price_3" step="0.01" min="0" class="ds-input" placeholder="€">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Item Button -->
                <button type="button" id="add-item-btn" class="ds-add-item-btn">
                    <span class="iconify" data-icon="lucide:plus" data-width="18"></span>
                    <span data-i18n="order.items.add">Добавить товар</span>
                </button>
            </div>

            <!-- Section 5: Collection Method -->
            <div class="ds-form-section">
                <div class="ds-section-header">
                    <div class="ds-section-icon teal">
                        <span class="iconify" data-icon="lucide:truck" data-width="20"></span>
                    </div>
                    <div>
                        <h2 class="ds-section-title" data-i18n="order.collection.title">Способ передачи посылки</h2>
                        <p class="ds-section-subtitle" data-i18n="order.collection.subtitle">Как вы передадите нам посылку</p>
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="ds-choice-card selected" data-choice="courier">
                        <input type="radio" name="collection_method" value="courier" checked>
                        <span class="ds-choice-indicator"></span>
                        <div class="ds-choice-content">
                            <p class="ds-choice-title" data-i18n="order.collection.courier">Курьер приедет ко мне</p>
                            <p class="ds-choice-description" data-i18n="order.collection.courier.desc">Курьер заберёт посылку с вашего адреса (Пн-Пт, 09:00-18:00)</p>
                        </div>
                    </label>
                    <label class="ds-choice-card" data-choice="self">
                        <input type="radio" name="collection_method" value="self">
                        <span class="ds-choice-indicator"></span>
                        <div class="ds-choice-content">
                            <p class="ds-choice-title" data-i18n="order.collection.self">Отправлю на склад самостоятельно</p>
                            <p class="ds-choice-description" data-i18n="order.collection.self.desc">Вы отправляете посылку на наш склад любой службой доставки</p>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Section 6: Collection Date -->
            <div id="courier-date-section" class="ds-form-section">
                <div class="ds-section-header">
                    <div class="ds-section-icon indigo">
                        <span class="iconify" data-icon="lucide:calendar" data-width="20"></span>
                    </div>
                    <div>
                        <h2 class="ds-section-title" data-i18n="order.date.title">Дата и время забора</h2>
                        <p class="ds-section-subtitle" data-i18n="order.date.subtitle">Когда курьеру приехать</p>
                    </div>
                </div>

                <div class="ds-form-grid cols-2">
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.date.date">Желаемая дата</label>
                        <input type="date" name="collection_date" required class="ds-input">
                    </div>
                    <div class="ds-field">
                        <label class="ds-label required" data-i18n="order.date.time">Время</label>
                        <div class="ds-select-wrapper">
                            <select name="collection_time" required class="ds-input">
                                <option value="morning" data-i18n="order.date.morning">До полудня (09:00-12:00)</option>
                                <option value="afternoon" data-i18n="order.date.afternoon">После полудня (12:00-18:00)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="ds-info-box amber mt-4">
                    <span class="iconify ds-info-box-icon" data-icon="lucide:alert-triangle"></span>
                    <span data-i18n="order.date.notice">Забор посылок: Пн-Пт. Выходные и праздники недоступны.</span>
                </div>
            </div>

            <!-- Section 7: Payment -->
            <div class="ds-form-section">
                <div class="ds-section-header">
                    <div class="ds-section-icon emerald">
                        <span class="iconify" data-icon="lucide:credit-card" data-width="20"></span>
                    </div>
                    <div>
                        <h2 class="ds-section-title" data-i18n="order.payment.title">Способ оплаты</h2>
                        <p class="ds-section-subtitle" data-i18n="order.payment.subtitle">Как вы будете оплачивать</p>
                    </div>
                </div>

                <label class="ds-choice-card selected">
                    <input type="radio" name="payment_method" value="bank_transfer" checked>
                    <span class="ds-choice-indicator"></span>
                    <div class="ds-choice-content">
                        <p class="ds-choice-title" data-i18n="order.payment.bank">Банковский перевод</p>
                        <p class="ds-choice-description" data-i18n="order.payment.bank.desc">Реквизиты будут отправлены после подтверждения заявки</p>
                    </div>
                </label>
            </div>

            <!-- Section 8: Agreement -->
            <div class="ds-form-section">
                <div class="ds-section-header">
                    <div class="ds-section-icon slate">
                        <span class="iconify" data-icon="lucide:check-square" data-width="20"></span>
                    </div>
                    <div>
                        <h2 class="ds-section-title" data-i18n="order.agreement.title">Подтверждение</h2>
                        <p class="ds-section-subtitle" data-i18n="order.agreement.subtitle">Ознакомьтесь с условиями</p>
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="ds-choice-card checkbox" id="agree-terms-card">
                        <input type="checkbox" name="agree_terms" required>
                        <span class="ds-choice-indicator"></span>
                        <div class="ds-choice-content">
                            <p class="ds-choice-description">
                                <span data-i18n="order.agreement.terms">Я соглашаюсь с</span>
                                <a href="offer.html" target="_blank" class="text-blue-600 hover:underline font-medium" data-i18n="order.agreement.offer">публичной офертой</a>
                                <span data-i18n="order.agreement.and">и</span>
                                <a href="privacy.html" target="_blank" class="text-blue-600 hover:underline font-medium" data-i18n="order.agreement.privacy">политикой конфиденциальности</a>
                            </p>
                        </div>
                    </label>
                    <label class="ds-choice-card checkbox" id="agree-overweight-card">
                        <input type="checkbox" name="agree_overweight" required>
                        <span class="ds-choice-indicator"></span>
                        <div class="ds-choice-content">
                            <p class="ds-choice-description" data-i18n="order.agreement.overweight">Я понимаю, что при превышении заявленного веса или размеров может потребоваться доплата</p>
                        </div>
                    </label>
                    <label class="ds-choice-card checkbox" id="agree-insurance-card">
                        <input type="checkbox" name="agree_insurance">
                        <span class="ds-choice-indicator"></span>
                        <div class="ds-choice-content">
                            <p class="ds-choice-description" data-i18n="order.agreement.insurance">Хочу застраховать посылку дополнительно (5% от заявленной стоимости содержимого)</p>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Submit -->
            <div class="text-center py-6">
                <button type="submit" id="submit-btn" class="ds-btn primary">
                    <span class="iconify" data-icon="lucide:send" data-width="20"></span>
                    <span data-i18n="order.submit">Отправить заявку</span>
                </button>
                <p class="mt-4 text-sm text-slate-500" data-i18n="order.submit.note">
                    После отправки мы свяжемся с вами в течение 30 минут
                </p>
            </div>
        </form>

        <!-- Contact -->
        <div class="text-center py-8 border-t border-slate-200 mt-8">
            <p class="text-sm text-slate-500 mb-4" data-i18n="order.contact.title">Есть вопросы? Свяжитесь с нами:</p>
            <div class="ds-contact-pills">
                <a href="https://wa.me/33753540436" class="ds-btn green">
                    <span class="iconify" data-icon="lucide:message-circle" data-width="18"></span>
                    WhatsApp
                </a>
                <a href="mailto:info.svexpress@gmail.com" class="ds-btn secondary">
                    <span class="iconify" data-icon="lucide:mail" data-width="18"></span>
                    Email
                </a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 text-sm py-12 px-6">
        <div class="max-w-3xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div>
                    <h3 class="text-white font-bold text-lg tracking-tight mb-4">SV EXPRESS</h3>
                    <p class="text-xs leading-relaxed" data-i18n="footer.description">Доставка посылок из Европы в СНГ с 2016 года. Надёжно. Быстро. Доступно.</p>
                </div>
                <div>
                    <h4 class="text-slate-200 font-semibold mb-3" data-i18n="footer.info.title">Информация</h4>
                    <ul class="space-y-2 text-xs">
                        <li><a href="packaging.html" class="hover:text-white" data-i18n="footer.info.packaging">Правила упаковки</a></li>
                        <li><a href="prohibited.html" class="hover:text-white" data-i18n="footer.info.prohibited">Запрещённые товары</a></li>
                        <li><a href="privacy.html" class="hover:text-white" data-i18n="footer.info.privacy">Политика конфиденциальности</a></li>
                        <li><a href="offer.html" class="hover:text-white" data-i18n="footer.info.offer">Публичная оферта</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-slate-200 font-semibold mb-3" data-i18n="footer.contacts.title">Контакты</h4>
                    <ul class="space-y-2 text-xs">
                        <li class="flex items-center gap-2">
                            <span class="iconify" data-icon="lucide:phone" data-width="14"></span>
                            +33 (753) 54 04 36
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="iconify" data-icon="lucide:mail" data-width="14"></span>
                            info.svexpress@gmail.com
                        </li>
                    </ul>
                    <!-- Language Switcher -->
                    <div class="mt-4 pt-4 border-t border-slate-800">
                        <p class="text-xs text-slate-500 mb-2" data-i18n="footer.language">Язык</p>
                        <div class="flex gap-2">
                            <button class="lang-switcher px-3 py-1 text-xs rounded bg-slate-800 hover:bg-slate-700 transition-colors" data-lang="ru">RU</button>
                            <button class="lang-switcher px-3 py-1 text-xs rounded bg-slate-800 hover:bg-slate-700 transition-colors" data-lang="en">EN</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-800 pt-8 text-xs text-center" data-i18n="footer.copyright">
                © 2024 SV EXPRESS. Все права защищены.
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('order-form');
            const submitBtn = document.getElementById('submit-btn');
            const courierDateSection = document.getElementById('courier-date-section');
            const collectionMethodInputs = document.querySelectorAll('input[name="collection_method"]');
            const dateInput = document.querySelector('input[name="collection_date"]');

            // Set min date to tomorrow
            if (dateInput) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                // Skip weekends
                while (tomorrow.getDay() === 0 || tomorrow.getDay() === 6) {
                    tomorrow.setDate(tomorrow.getDate() + 1);
                }
                dateInput.min = tomorrow.toISOString().split('T')[0];
                dateInput.value = tomorrow.toISOString().split('T')[0];
            }

            // Choice card selection
            function setupChoiceCards(name) {
                const cards = document.querySelectorAll(`input[name="${name}"]`);
                cards.forEach(input => {
                    const card = input.closest('.ds-choice-card');
                    if (!card) return;

                    // Initial state
                    if (input.checked) card.classList.add('selected');

                    input.addEventListener('change', () => {
                        // For radio buttons, deselect all others
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${name}"]`).forEach(other => {
                                const otherCard = other.closest('.ds-choice-card');
                                if (otherCard) otherCard.classList.remove('selected');
                            });
                        }

                        // Toggle current
                        if (input.checked) {
                            card.classList.add('selected');
                        } else {
                            card.classList.remove('selected');
                        }
                    });
                });
            }

            setupChoiceCards('collection_method');
            setupChoiceCards('payment_method');
            setupChoiceCards('agree_terms');
            setupChoiceCards('agree_overweight');
            setupChoiceCards('agree_insurance');

            // Get translations helper
            function t(key) {
                const lang = localStorage.getItem('sv-express-lang') || 'ru';
                return (window.translations && window.translations[lang] && window.translations[lang][key]) || key;
            }

            // Add item functionality
            const itemsContainer = document.getElementById('items-container');
            const addItemBtn = document.getElementById('add-item-btn');
            let itemCount = 3;
            const maxItems = 10;

            function createItemRow(num) {
                const div = document.createElement('div');
                div.className = 'ds-item-row';
                div.setAttribute('data-item', num);
                div.innerHTML = `
                    <span class="ds-item-number">${t('order.items.item')} ${num}</span>
                    <button type="button" class="ds-remove-item" onclick="removeItem(this)">
                        <span class="iconify" data-icon="lucide:x" data-width="14"></span>
                    </button>
                    <div class="ds-form-grid cols-4">
                        <div class="ds-field ds-col-span-2">
                            <input type="text" name="item_desc_${num}" class="ds-input" placeholder="${t('order.items.description')}">
                        </div>
                        <div class="ds-field">
                            <input type="number" name="item_qty_${num}" min="1" value="1" class="ds-input" style="text-align: center;">
                        </div>
                        <div class="ds-field">
                            <input type="number" name="item_price_${num}" step="0.01" min="0" class="ds-input" placeholder="€">
                        </div>
                    </div>
                `;
                return div;
            }

            addItemBtn.addEventListener('click', () => {
                if (itemCount >= maxItems) {
                    alert(t('order.items.max'));
                    return;
                }
                itemCount++;
                const newRow = createItemRow(itemCount);
                itemsContainer.appendChild(newRow);

                // Focus on new input
                newRow.querySelector('input[type="text"]').focus();

                // Update button text
                if (itemCount >= maxItems) {
                    addItemBtn.style.display = 'none';
                }
            });

            // Remove item function (global)
            window.removeItem = function(btn) {
                const row = btn.closest('.ds-item-row');
                if (row && itemsContainer.children.length > 1) {
                    row.remove();
                    itemCount = itemsContainer.children.length;
                    // Re-number items
                    Array.from(itemsContainer.children).forEach((r, idx) => {
                        const num = idx + 1;
                        r.setAttribute('data-item', num);
                        const numLabel = r.querySelector('.ds-item-number');
                        if (numLabel) numLabel.textContent = `${t('order.items.item')} ${num}`;
                        // Update input names
                        r.querySelectorAll('input').forEach(input => {
                            const name = input.name.replace(/_\d+$/, `_${num}`);
                            input.name = name;
                        });
                    });
                    // Show add button if hidden
                    if (itemCount < maxItems) {
                        addItemBtn.style.display = 'flex';
                    }
                }
            };

            // Toggle courier date section
            collectionMethodInputs.forEach(input => {
                input.addEventListener('change', () => {
                    if (input.value === 'courier' && input.checked) {
                        courierDateSection.style.display = 'block';
                        dateInput.required = true;
                    } else if (input.value === 'self' && input.checked) {
                        courierDateSection.style.display = 'none';
                        dateInput.required = false;
                    }
                });
            });

            // Form submission
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                // Collect items dynamically
                const items = [];
                const itemRows = document.querySelectorAll('.ds-item-row');
                itemRows.forEach((row, idx) => {
                    const num = idx + 1;
                    const desc = data[`item_desc_${num}`];
                    if (desc && desc.trim()) {
                        items.push({
                            description: desc,
                            quantity: parseInt(data[`item_qty_${num}`]) || 1,
                            price: parseFloat(data[`item_price_${num}`]) || 0
                        });
                    }
                });
                data.items = items;

                // Disable button
                const originalHTML = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = `<span class="iconify animate-spin" data-icon="lucide:loader-2" data-width="20"></span> ${t('order.submit.sending')}`;

                try {
                    const apiUrl = 'https://api-oy5fw1sm7-gregs-projects-c94a974d.vercel.app/api/orders';
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        alert(t('order.submit.success'));
                        form.reset();
                        window.location.href = 'index.html';
                    } else {
                        throw new Error(result.error || 'Error');
                    }
                } catch (error) {
                    console.error('Order submission error:', error);
                    alert(t('order.submit.error'));
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalHTML;
                }
            });
        });
    </script>

    <!-- Floating WhatsApp Button -->
    <a href="https://wa.me/33753540436" class="fixed bottom-6 right-6 bg-[#25D366] text-white p-3.5 rounded-full shadow-lg hover:bg-[#20bd5a] transition-all hover:-translate-y-1 z-50 flex items-center gap-2 group">
        <span class="iconify" data-icon="lucide:message-circle" data-width="24"></span>
        <span class="max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-300 ease-in-out whitespace-nowrap text-sm font-semibold pr-0 group-hover:pr-2"><span data-i18n="whatsapp.button">Написать нам</span></span>
    </a>

    <script src="assets/js/translations.js"></script>
    <script src="assets/js/main.js"></script>
</body>
</html>
